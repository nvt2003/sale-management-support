<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<h4>Product quantity management</h4>
<div class="d-flex justify-content-between">
    @foreach (var product in ViewData["ProductCodes"] as List<Objects.Models.Product>)
    {
        <div width='100' height='100' id="product+@product.ProductCode" onclick='calProduct("@product.ProductCode")'>@product.ProductName</div>
    }
</div>

<h4>Chart</h4>
<canvas id="myChart" style="width:100%;max-width:600px"></canvas>
<br />
<canvas id="mySecondChart" width="400" height="200"></canvas>

<script>
    $(document).ready(function () {
        const xValues = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12];
        let yValues = new Array(12).fill(0);

        fetch("https://localhost:7260/api/Invoice?$select=TotalAmount,InvoiceDate")
            .then(response => response.json())
            .then(data => {
                data.forEach(invoice => {
                    const month = new Date(invoice.InvoiceDate).getMonth();
                    yValues[month] += invoice.TotalAmount;
                });

                new Chart("myChart", {
                    type: "line",
                    data: {
                        labels: xValues,
                        datasets: [{
                            fill: false,
                            lineTension: 0,
                            backgroundColor: "rgba(0,0,255,1.0)",
                            borderColor: "rgba(0,0,255,0.1)",
                            data: yValues
                        }]
                    },
                    options: {
                        legend: { display: false },
                        scales: {
                            yAxes: [{
                                ticks: {
                                    min: 6,
                                    max: Math.max(...yValues) + 10, 
                                    stepSize: 50 
                                }
                            }]
                        },
                        title: {
                            display: true,
                            text: 'Biểu đồ doanh thu năm 2024',
                            fontSize: 16
                        }
                    }
                });
            })
            .catch(error => console.error('Error fetching data:', error)); // Handle fetch errors
    });
</script>
<script>
    $(document).ready(function () {
        // Initialize months array (1 to 12)
        const xValues = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12];
        let yValues = new Array(12).fill(0);

        // Fetch data from the API
        fetch("https://localhost:7260/api/ImportProduct?$select=Quantity,UnitPrice,ImportDate")
            .then(response => response.json())
            .then(data => {
                // Process each item in the response
                data.forEach(item => {
                    const importDate = new Date(item.ImportDate); 
                    const month = importDate.getMonth();  
                    const amount = item.Quantity * item.UnitPrice;

                    if (month >= 0 && month < 12) {
                        yValues[month] += amount; 
                    }
                });

                new Chart("mySecondChart", {
                    type: "line",  
                    data: {
                        labels: xValues,  
                        datasets: [{
                            fill: false,  
                            lineTension: 0,  
                            backgroundColor: "rgba(0,255,0,1.0)",  
                            borderColor: "rgba(0,255,0,0.1)", 
                            data: yValues  
                        }]
                    },
                    options: {
                        legend: { display: false },  
                        scales: {
                            yAxes: [{
                                ticks: {
                                    min: 6,
                                    max: Math.max(...yValues) + 10,
                                    stepSize: 50
                                }
                            }]
                        },
                        title: {
                            display: true,
                            text: 'Biểu đồ nhập hàng năm 2024',  
                            fontSize: 16
                        }
                    }
                });
            })
            .catch(error => console.error('Error fetching data:', error));  
    });
    function calProduct(productCode) {
            const id = 'product+'+productCode;
                $.ajax({
                    url: '@Url.Action("GetNumberOfProduct", "ImportProduct")',
                    type: 'POST',
                    data: {
                        ProductId: productCode
                    },
                    success: function (response) {
                        var res = JSON.parse(response);
                        $('#'+id).text($('#'+id).text()+': '+res[0].TotalQuantity)
                        document.getElementById(id).innerText += ': '+res[0].TotalQuantity;
                    },
                    error: function (xhr, status, error) {
                        alert('Error: ' + error);
                    }
                });
        }
</script>